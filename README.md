# openclaw-napcatqq

OpenClaw é€šé“æ’ä»¶ â€”â€” é€šè¿‡ [NapCatQQ](https://github.com/NapNeko/NapCatQQ)ï¼ˆOneBot v11 WebSocketï¼‰å¯¹æ¥ QQã€‚

ä¸å®˜æ–¹ Telegram / Discord / é£ä¹¦ç­‰é€šé“æ’ä»¶å®Œå…¨å¯¹é½ï¼Œå®ç°äº† OpenClaw ChannelPlugin SDK çš„å…¨éƒ¨ 14 ä¸ªé€‚é…å™¨ + 10 ä¸ªæ¶ˆæ¯ Actionã€‚

## åŠŸèƒ½

### æ¶ˆæ¯èƒ½åŠ›

- âœ… ç§èŠ / ç¾¤èŠæ”¶å‘æ–‡æœ¬æ¶ˆæ¯
- âœ… å›¾ç‰‡æ”¶å‘ï¼ˆå…¥ç«™ï¼šä¸‹è½½è½¬ base64 â†’ Agent ImageContentï¼Œæœ€å¤š 5 å¼ ï¼›å‡ºç«™ï¼šURL/base64 å‘é€ï¼‰
- âœ… å¤šå›¾å‘é€ï¼ˆAgent è¿”å›å¤šå¼ å›¾ç‰‡æ—¶è‡ªåŠ¨é€å¼ å‘é€ï¼‰
- âœ… è¯­éŸ³æ”¶å‘ï¼ˆå…¥ç«™ï¼šè‡ªåŠ¨ä¸‹è½½è½¬å†™ï¼›å‡ºç«™ï¼š`record` æ¶ˆæ¯æ®µç‹¬ç«‹å‘é€ï¼‰
- âœ… è§†é¢‘æ¶ˆæ¯è§£æï¼ˆå…¥ç«™ï¼šURL é™„åŠ åˆ°æ–‡æœ¬ä¾› Agent å‚è€ƒï¼‰
- âœ… è¯­éŸ³è½¬å†™ï¼ˆå§”æ‰˜ SDK `transcribeFirstAudio`ï¼Œæ”¯æŒ openai / deepgram / google / groq ç­‰ providerï¼‰
- âœ… å¼•ç”¨å›å¤ï¼ˆå…¥ç«™ï¼šæå–è¢«å¼•ç”¨æ¶ˆæ¯å†…å®¹å’Œå‘é€è€…ï¼›å‡ºç«™ï¼š`[[reply_to:xxx]]` æ ‡ç­¾ï¼‰
- âœ… æ–‡ä»¶å‘é€ï¼ˆ`sendAttachment` actionï¼Œé€šè¿‡ `base64://` å‰ç¼€è·¨æœåŠ¡å™¨ä¼ è¾“ï¼‰
- âœ… å…¨é‡æ¶ˆæ¯æ®µè§£æï¼ˆ23 ç§ OneBot v11 æ®µç±»å‹ï¼šè¡¨æƒ…/è§†é¢‘/æ–‡ä»¶/ä½ç½®/å¡ç‰‡/å°ç¨‹åº/åˆå¹¶è½¬å‘ç­‰ï¼‰
- âœ… QQ è¡¨æƒ… â†’ Unicode Emoji æ˜ å°„ï¼ˆ130+ ä¸ª face ID åŒå‘æ˜ å°„ï¼‰
- âœ… åˆå¹¶è½¬å‘æ¶ˆæ¯å±•å¼€ï¼ˆè§£æå‰ 5 æ¡è½¬å‘å†…å®¹å«å‘é€è€…åç§°ï¼‰
- âœ… Markdown æ„ŸçŸ¥çš„é•¿æ¶ˆæ¯è‡ªåŠ¨åˆ‡åˆ†ï¼ˆ4000 å­—ç¬¦é™åˆ¶ï¼‰
- âœ… Typing è¾“å…¥çŠ¶æ€æŒ‡ç¤ºï¼ˆç§èŠæ˜¾ç¤º"æ­£åœ¨è¾“å…¥"ï¼ŒNapCat `set_input_status` APIï¼‰

### æ¶ˆæ¯ Actionï¼ˆ10 ä¸ªï¼‰

| Action | è¯´æ˜ |
|--------|------|
| `send` | ä¸»åŠ¨å‘æ¶ˆæ¯ï¼ˆæŒ‡å®šç›®æ ‡ QQ å·æˆ– `gç¾¤å·`ï¼‰ |
| `reply` | å¼•ç”¨å›å¤æŒ‡å®šæ¶ˆæ¯ |
| `react` | æ¶ˆæ¯è¡¨æƒ…å›åº”ï¼ˆ`set_msg_emoji_like`ï¼Œé»˜è®¤ ğŸ‘ï¼‰ |
| `unsend` | æ’¤å›æ¶ˆæ¯ |
| `delete` | åˆ é™¤æ¶ˆæ¯ï¼ˆåŒ unsendï¼‰ |
| `read` | æ ‡è®°æ¶ˆæ¯å·²è¯» |
| `sendAttachment` | å‘é€æ–‡ä»¶ï¼ˆç§èŠ/ç¾¤èŠï¼‰ |
| `member-info` | æŸ¥è¯¢ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆè§’è‰²/å¤´è¡”/ç­‰çº§ï¼‰ |
| `pin` | è®¾ä¸ºç²¾åæ¶ˆæ¯ |
| `unpin` | å–æ¶ˆç²¾åæ¶ˆæ¯ |

### è®¿é—®æ§åˆ¶

- âœ… ç§èŠé…å¯¹è®¤è¯ï¼ˆpairingï¼‰â€” æ–°ç”¨æˆ·éœ€ç®¡ç†å‘˜å®¡æ‰¹
- âœ… ç§èŠ QQ å¿«æ·å®¡æ‰¹ â€” ç®¡ç†å‘˜ç›´æ¥å›å¤ `æ‰¹å‡†ç”¨æˆ· QQå·`
- âœ… ç¾¤èŠé…å¯¹å®¡æ‰¹ï¼ˆpairingï¼‰â€” æ–°ç¾¤éœ€ç®¡ç†å‘˜æ‰¹å‡†
- âœ… ç¾¤èŠ QQ å¿«æ·å®¡æ‰¹ â€” ç®¡ç†å‘˜ç›´æ¥å›å¤ `æ‰¹å‡†ç¾¤ ç¾¤å·`
- âœ… ç¾¤èŠ @æœºå™¨äºº è¿‡æ»¤ï¼ˆå¯é…ç½®ï¼‰
- âœ… ç¾¤èŠç™½åå•ï¼ˆallowlistï¼‰/ å…¨å¼€æ”¾ï¼ˆopenï¼‰/ å…³é—­ï¼ˆdisabledï¼‰
- âœ… `/model` `/status` `/reset` ç­‰æ–œæ å‘½ä»¤ï¼ˆæƒé™åŸºäº allowFromï¼‰
- âœ… æ§åˆ¶å‘½ä»¤æ‹¦æˆªï¼ˆæœªæˆæƒç”¨æˆ·å‘æ§åˆ¶å‘½ä»¤é™é»˜ä¸¢å¼ƒï¼‰

### äº‹ä»¶å¤„ç†

- âœ… `notice.group_decrease.kick_me` â€” æœºå™¨äººè¢«è¸¢å‡ºç¾¤è‡ªåŠ¨æ¸…ç† + é€šçŸ¥ç®¡ç†å‘˜
- âœ… `notice.group_ban.ban` â€” æœºå™¨äººè¢«ç¦è¨€æ£€æµ‹ + é€šçŸ¥ç®¡ç†å‘˜ï¼ˆå«æ—¶é•¿/æ“ä½œè€…ï¼‰
- âœ… `notice.friend_add` â€” æ–°å¥½å‹æ·»åŠ é€šçŸ¥ç®¡ç†å‘˜
- âœ… `request.friend` â€” å¥½å‹è¯·æ±‚å¤„ç†ï¼ˆ`autoAcceptFriend` å¼€å…³ï¼Œé»˜è®¤å…³é—­ï¼‰
- âœ… `request.group.invite` â€” å…¥ç¾¤é‚€è¯·å¤„ç†ï¼ˆ`autoAcceptGroupInvite` å¼€å…³ï¼Œé»˜è®¤å…³é—­ï¼‰
- âœ… `message_sent` â€” æœºå™¨äººè‡ªå‘æ¶ˆæ¯è®°å…¥ç¾¤èŠå†å²ä¸Šä¸‹æ–‡
- âœ… `bot_offline` â€” æœºå™¨äººç¦»çº¿é€šçŸ¥ç®¡ç†å‘˜
- âœ… `notify.poke` â€” æˆ³ä¸€æˆ³äº‹ä»¶æ—¥å¿—è®°å½•
- âœ… æ”¶åˆ°æ¶ˆæ¯è‡ªåŠ¨æ ‡è®°å·²è¯»ï¼ˆ`mark_msg_as_read`ï¼‰
- âœ… æ”¶åˆ°æ¶ˆæ¯å¯é€‰è¡¨æƒ…å›åº”ï¼ˆ`emojiAck` å¼€å…³ï¼‰

### ç¾¤èŠå¢å¼º

- âœ… ç¾¤èŠå†å²ä¸Šä¸‹æ–‡ï¼ˆè¢«å¿½ç•¥çš„æ¶ˆæ¯ä½œä¸º Agent ä¸Šä¸‹æ–‡ï¼‰
- âœ… å¯åŠ¨æ—¶é¢„åŠ è½½å·²æ‰¹å‡†ç¾¤çš„å†å²æ¶ˆæ¯ï¼ˆ`get_group_msg_history`ï¼‰
- âœ… æ¶ˆæ¯é˜²æŠ–åˆå¹¶ï¼ˆè¿ç»­å¤šæ¡æ¶ˆæ¯åˆå¹¶ä¸ºä¸€æ¡å¤„ç†ï¼‰
- âœ… Agent ä¿¡å°æ ¼å¼ï¼ˆ`å‘é€è€…@ç¾¤å`ï¼Œå«æ—¶é—´æˆ³ï¼‰
- âœ… ç¾¤èŠå·¥å…·æƒé™ç­–ç•¥

### è¿æ¥ä¸ç®¡ç†

- âœ… WSS æ”¯æŒï¼ˆå®å¡” / Nginx HTTPS åä»£ï¼‰
- âœ… Token é€šè¿‡ `Authorization: Bearer` Header ä¼ é€’ï¼ˆä¸æš´éœ²åœ¨ URLï¼‰
- âœ… è‡ªåŠ¨é‡è¿ + å¿ƒè·³æ£€æµ‹ï¼ˆé»˜è®¤ 60 ç§’è¶…æ—¶ï¼‰
- âœ… é‡è¿æ—¶è‡ªåŠ¨æ¸…ç†æŒ‚èµ·çš„ API è°ƒç”¨
- âœ… å¤šè´¦å·
- âœ… `openclaw channels login` å‘å¯¼å¼é…ç½®ï¼ˆ10 æ­¥ï¼‰
- âœ… æ§åˆ¶é¢æ¿ JSON Schema è¡¨å•æ¸²æŸ“ï¼ˆå…¨ä¸­æ–‡æ ‡ç­¾ï¼‰
- âœ… çƒ­é‡è½½ï¼ˆä¿®æ”¹é…ç½®åæ— éœ€é‡å¯ Gatewayï¼‰
- âœ… `openclaw status` çŠ¶æ€å±•ç¤ºï¼ˆbot æ˜µç§°ã€è¿æ¥çŠ¶æ€ã€é—®é¢˜è¯Šæ–­ï¼‰
- âœ… selfId è‡ªåŠ¨å›å†™ï¼ˆè¿æ¥æˆåŠŸåè‡ªåŠ¨å°†æœºå™¨äºº QQ å·å†™å…¥é…ç½®ï¼‰
- âœ… è”ç³»äºº/ç¾¤åˆ—è¡¨ç›®å½•æŸ¥è¯¢
- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥ credentials pairing store åˆ° `dm.allowFrom` é…ç½®

### èƒ½åŠ›å£°æ˜

| èƒ½åŠ› | çŠ¶æ€ |
|------|------|
| ç§èŠ / ç¾¤èŠ | âœ… |
| å¼•ç”¨å›å¤ | âœ… |
| åª’ä½“ï¼ˆå›¾ç‰‡/è¯­éŸ³/è§†é¢‘/æ–‡ä»¶ï¼‰ | âœ… |
| è¡¨æƒ…å›åº” | âœ… |
| æ’¤å›æ¶ˆæ¯ | âœ… |
| æ¶ˆæ¯ç¼–è¾‘ | âŒï¼ˆQQ åè®®ä¸æ”¯æŒï¼‰ |
| æŠ•ç¥¨ | âŒ |
| æ¶ˆæ¯çº¿ç¨‹ | âŒ |
| æ¶ˆæ¯ç‰¹æ•ˆ | âŒ |

## å‰ç½®æ¡ä»¶

1. ä¸€å°è¿è¡Œ [NapCatQQ](https://github.com/NapNeko/NapCatQQ) çš„æœåŠ¡å™¨ï¼Œ**æ­£å‘ WebSocket** å·²å¼€å¯
2. NapCat æ¶ˆæ¯æ ¼å¼è®¾ä¸º **Array**ï¼ˆæ¨èï¼›String æ ¼å¼ä¹Ÿæ”¯æŒï¼Œè‡ªåŠ¨å…¼å®¹ï¼‰
3. OpenClaw Gateway å·²å®‰è£…å¹¶è¿è¡Œ

## å®‰è£…

### ä» GitHub å®‰è£…

```bash
openclaw plugins install github:longlannet/openclaw-napcatqq
```

### ä»æœ¬åœ°ç›®å½•å®‰è£…ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

```bash
git clone https://github.com/longlannet/openclaw-napcatqq.git
openclaw plugins install ./openclaw-napcatqq --link
```

> `--link` åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œä¿®æ”¹æºç å³æ—¶ç”Ÿæ•ˆï¼Œé€‚åˆå¼€å‘è°ƒè¯•ã€‚

å®‰è£…å‘½ä»¤ä¼šè‡ªåŠ¨æ·»åŠ  `plugins.allow` å’Œ `plugins.load.paths` é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘ã€‚
æ’ä»¶ä½¿ç”¨ `.ts` æºç ç›´æ¥åŠ è½½ï¼Œæ— éœ€ç¼–è¯‘ã€‚

## é…ç½®

### æ–¹å¼ä¸€ï¼šå‘å¯¼å¼ï¼ˆæ¨èï¼‰

```bash
openclaw channels login napcatqq
```

å‘å¯¼ä¼šä¾æ¬¡è¯¢é—®ï¼š

1. **è´¦å· ID** â€” å¤šè´¦å·æ ‡è¯†ï¼ˆé»˜è®¤ `default`ï¼‰
2. **WebSocket URL** â€” `wss://ä½ çš„åŸŸå`ï¼ˆå¿…å¡«ï¼‰
3. **Access Token** â€” OneBot access_tokenï¼ˆå¯ç•™ç©ºï¼‰
4. **DM è®¿é—®ç­–ç•¥** â€” pairingï¼ˆéœ€å®¡æ‰¹ï¼‰/ openï¼ˆå…¨æ”¾è¡Œï¼‰/ closedï¼ˆå…¨æ‹’ç»ï¼‰
5. **ç®¡ç†å‘˜ QQ å·** â€” å¿…å¡«ï¼Œç”¨äºå®¡æ‰¹é€šçŸ¥
6. **ç¾¤èŠç­–ç•¥** â€” disabled / pairing / open / allowlist
7. **ç¾¤èŠ @æœºå™¨äºº** â€” æ˜¯å¦éœ€è¦ @æ‰å“åº”
8. **è‡ªåŠ¨åŒæ„å¥½å‹è¯·æ±‚** â€” æ˜¯å¦è‡ªåŠ¨æ¥å—
9. **è‡ªåŠ¨åŒæ„å…¥ç¾¤é‚€è¯·** â€” æ˜¯å¦è‡ªåŠ¨æ¥å—
10. **æ¶ˆæ¯è¡¨æƒ…å›åº”** â€” æ”¶åˆ°æ¶ˆæ¯æ˜¯å¦æ‰“ â¤ï¸

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘ `openclaw.json`

```jsonc
{
  "channels": {
    "napcatqq": {
      "accounts": {
        "default": {
          "enabled": true,
          "wsUrl": "wss://ä½ çš„åŸŸå",
          "accessToken": "ä½ çš„token",
          "requireMention": true,
          "groupPolicy": "pairing",
          "groupAllowFrom": [],
          "allowFrom": ["ä½ çš„QQå·"],
          "autoAcceptFriend": false,
          "autoAcceptGroupInvite": false,
          "emojiAck": false,
          "dm": {
            "policy": "pairing",
            "allowFrom": []
          }
        }
      }
    }
  }
}
```

### é…ç½®å®Œæˆåé‡å¯ Gateway

```bash
openclaw gateway restart
```

## é…ç½®å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `wsUrl` | string | **å¿…å¡«** | NapCat WebSocket åœ°å€ï¼Œå¦‚ `wss://ncqq.example.com` |
| `accessToken` | string | â€” | OneBot access_tokenï¼Œé€šè¿‡ Authorization Header ä¼ é€’ |
| `selfId` | string | è‡ªåŠ¨è·å– | æœºå™¨äºº QQ å·ï¼Œè¿æ¥åè‡ªåŠ¨æå–å¹¶å›å†™åˆ°é…ç½® |
| `requireMention` | boolean | `true` | ç¾¤èŠæ˜¯å¦éœ€è¦ @æœºå™¨äºº æ‰å“åº” |
| `commandPrefix` | string | `"/"` | å‘½ä»¤å‰ç¼€ |
| `defaultTo` | string | â€” | é»˜è®¤å‘é€ç›®æ ‡ï¼ˆmessage å·¥å…·çœç•¥ target æ—¶ä½¿ç”¨ï¼‰ |
| `groupPolicy` | string | `"disabled"` | ç¾¤èŠç­–ç•¥ï¼š`disabled` / `open` / `allowlist` / `pairing` |
| `groupAllowFrom` | array | â€” | ç¾¤èŠç™½åå•ï¼ˆ`gç¾¤å·` æˆ–çº¯ç¾¤å·æˆ– QQ å·ï¼‰ |
| `historyLimit` | number | `50` | ç¾¤èŠå†å²æ¶ˆæ¯ç¼“å­˜æ¡æ•°ä¸Šé™ |
| `allowFrom` | array | â€” | ç®¡ç†å‘˜/ç™½åå• QQ å·åˆ—è¡¨ |
| `autoAcceptFriend` | boolean | `false` | è‡ªåŠ¨åŒæ„å¥½å‹è¯·æ±‚ï¼ˆå…³é—­æ—¶ä»…é€šçŸ¥ç®¡ç†å‘˜ï¼‰ |
| `autoAcceptGroupInvite` | boolean | `false` | è‡ªåŠ¨åŒæ„å…¥ç¾¤é‚€è¯·ï¼ˆå…³é—­æ—¶ä»…é€šçŸ¥ç®¡ç†å‘˜ï¼‰ |
| `emojiAck` | boolean | `false` | æ”¶åˆ°æ¶ˆæ¯æ—¶è‡ªåŠ¨æ‰“ â¤ï¸ è¡¨æƒ…å›åº” |
| `dm.policy` | string | `"pairing"` | ç§èŠç­–ç•¥ï¼š`pairing` / `open` / `closed` |
| `dm.allowFrom` | array | â€” | ç§èŠç™½åå•ï¼ˆä¸ `allowFrom` åˆå¹¶ä½¿ç”¨ï¼Œéäº’æ–¥ï¼‰ |

## è®¿é—®æ§åˆ¶

### allowFrom åˆå¹¶è§„åˆ™

`dm.allowFrom` å’Œ `allowFrom` æ˜¯**åˆå¹¶å…³ç³»**ï¼Œä¸æ˜¯è¦†ç›–å…³ç³»ã€‚è®¿é—®æ§åˆ¶æ£€æŸ¥æ—¶ï¼Œä¸¤ä¸ªåˆ—è¡¨ä¸­çš„ QQ å·éƒ½è¢«è§†ä¸ºå·²æˆæƒã€‚ä¾‹å¦‚ï¼š

```jsonc
{
  "allowFrom": ["123456"],       // ç®¡ç†å‘˜
  "dm": {
    "allowFrom": ["789012"]      // å·²æ‰¹å‡†çš„ç”¨æˆ·
  }
}
// å®é™…ç”Ÿæ•ˆçš„ç™½åå• = ["123456", "789012"]
```

### ç§èŠé…å¯¹

æ’ä»¶é»˜è®¤ä½¿ç”¨ `pairing` ç­–ç•¥ï¼ˆå’Œ Telegram ä¸€è‡´ï¼‰ï¼š

1. é™Œç”Ÿç”¨æˆ·ç§èŠæœºå™¨äºº â†’ ç”¨æˆ·æ”¶åˆ°ã€Œâ³ éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†ã€
2. ç®¡ç†å‘˜ï¼ˆ`allowFrom` ä¸­çš„ QQ å·ï¼‰åŒæ—¶æ”¶åˆ°é€šçŸ¥ï¼ŒåŒ…å«æ˜µç§°/QQå·/æ¶ˆæ¯é¢„è§ˆ
3. ä¸¤ç§å®¡æ‰¹æ–¹å¼ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š
   - **QQ å¿«æ·å®¡æ‰¹**ï¼šç®¡ç†å‘˜ç›´æ¥å›å¤ `æ‰¹å‡†ç”¨æˆ· QQå·`
   - **CLI å®¡æ‰¹**ï¼š`openclaw pairing approve napcatqq <Code>`
4. ç”¨æˆ·æ”¶åˆ°é…å¯¹æˆåŠŸé€šçŸ¥ï¼Œåç»­æ¶ˆæ¯æ­£å¸¸è·¯ç”±åˆ° Agent

> **åŒå­˜å‚¨æœºåˆ¶**ï¼šQQ `æ‰¹å‡†ç”¨æˆ·` å‘½ä»¤å†™å…¥é…ç½®æ–‡ä»¶çš„ `dm.allowFrom`ï¼›CLI `openclaw pairing approve` å†™å…¥ `~/.openclaw/credentials/napcatqq-default-allowFrom.json`ã€‚æ’ä»¶å¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥ credentials store åˆ° `dm.allowFrom`ï¼Œä¸¤ç§æ–¹å¼éƒ½æœ‰æ•ˆã€‚

### ç¾¤èŠå®¡æ‰¹

å½“ `groupPolicy` è®¾ä¸º `pairing` æ—¶ï¼š

1. æœ‰äººåœ¨æ–°ç¾¤ @æœºå™¨äºº â†’ ç®¡ç†å‘˜ç§èŠæ”¶åˆ°é€šçŸ¥ï¼ˆç¾¤å/ç¾¤å·/å‘é€è€…ï¼‰
2. ä¸¤ç§å®¡æ‰¹æ–¹å¼ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š
   - **QQ å¿«æ·å®¡æ‰¹**ï¼šç®¡ç†å‘˜å›å¤ `æ‰¹å‡†ç¾¤ ç¾¤å·`
   - **CLI é…ç½®**ï¼š`openclaw config set channels.napcatqq.accounts.default.groupAllowFrom --append gç¾¤å·`
3. å®¡æ‰¹åè¯¥ç¾¤æ°¸ä¹…ç”Ÿæ•ˆï¼ˆå†™å…¥ `groupAllowFrom` é…ç½®ï¼‰

### ç¾¤èŠç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | è¡Œä¸º |
|------|------|
| `disabled`ï¼ˆé»˜è®¤ï¼‰ | å®Œå…¨å¿½ç•¥ç¾¤èŠæ¶ˆæ¯ï¼ˆé™é»˜è®°å½•å†å²ï¼‰ |
| `pairing` | æ–°ç¾¤éœ€ç®¡ç†å‘˜å®¡æ‰¹ï¼Œå·²æ‰¹å‡†ç¾¤æ­£å¸¸å“åº” |
| `allowlist` | ä»… `groupAllowFrom` ä¸­çš„ç¾¤å·å¯è§¦å‘ |
| `open` | æ‰€æœ‰ç¾¤éƒ½å¯è§¦å‘ï¼ˆéœ€ @æœºå™¨äººï¼Œé™¤é `requireMention: false`ï¼‰ |

### ç®¡ç†å·²æ‰¹å‡†ç”¨æˆ·

```bash
# æŸ¥çœ‹å¾…å®¡æ‰¹åˆ—è¡¨
openclaw pairing list napcatqq

# CLI æ‰¹å‡†
openclaw pairing approve napcatqq <Code>
```

## æ¶ˆæ¯æ”¯æŒ

### å…¥ç«™ï¼ˆQQ â†’ Agentï¼‰

| ç±»å‹ | å¤„ç†æ–¹å¼ |
|------|---------|
| æ–‡æœ¬ | ç›´æ¥ä¼ é€’ |
| å›¾ç‰‡ | ä¸‹è½½è½¬ base64 ImageContentï¼ˆæœ€å¤š 5 å¼ ï¼‰ï¼Œæ–‡æœ¬æ ‡è®° `[å›¾ç‰‡]` æˆ– `[å›¾ç‰‡: æè¿°]` |
| è¯­éŸ³ | ä¸‹è½½åˆ°æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ â†’ SDK è‡ªåŠ¨è½¬å†™ â†’ æ¸…ç†ä¸´æ—¶æ–‡ä»¶ |
| è§†é¢‘ | æå–è§†é¢‘ URL é™„åŠ åˆ°æ–‡æœ¬ `[è§†é¢‘: URL]`ï¼Œä¾› Agent å‚è€ƒ |
| æ–‡ä»¶ | `[æ–‡ä»¶: æ–‡ä»¶å]` æˆ– `[æ–‡ä»¶: æ–‡ä»¶å (å¤§å°)]` |
| QQ è¡¨æƒ… | è‡ªåŠ¨æ˜ å°„ä¸º Unicode Emojiï¼ˆ130+ è¡¨æƒ…ï¼Œæœªæ˜ å°„çš„æ˜¾ç¤º `[è¡¨æƒ…:ID]`ï¼‰ |
| å•†åŸè¡¨æƒ… | è¡¨æƒ…æ‘˜è¦å¦‚ `[å¼€å¿ƒ]` |
| ä½ç½® | `[ä½ç½®: æ ‡é¢˜ å†…å®¹ (ç»çº¬åº¦)]` |
| JSON å¡ç‰‡ | æå–æ‘˜è¦ `[å¡ç‰‡: æè¿°]` |
| å°ç¨‹åº | `[å°ç¨‹åºæ¶ˆæ¯]` |
| åˆå¹¶è½¬å‘ | å±•å¼€å‰ 5 æ¡è½¬å‘å†…å®¹ï¼ˆå«å‘é€è€…åç§°ï¼‰ |
| å¼•ç”¨å›å¤ | é€šè¿‡ `get_msg` API è·å–è¢«å¼•ç”¨æ¶ˆæ¯çš„å†…å®¹å’Œå‘é€è€… |
| @æåŠ | æå–è¢« @ çš„ QQ å·åˆ—è¡¨ï¼Œç”¨äº mention æ£€æµ‹ |

### å‡ºç«™ï¼ˆAgent â†’ QQï¼‰

| ç±»å‹ | æ”¯æŒ |
|------|------|
| çº¯æ–‡æœ¬ | âœ… |
| å›¾ç‰‡ï¼ˆURL / base64ï¼‰ | âœ… |
| å¤šå›¾å‘é€ | âœ…ï¼ˆé€å¼ å‘é€ï¼‰ |
| è¯­éŸ³ | âœ…ï¼ˆç‹¬ç«‹å‘é€ï¼Œä¸ä¸æ–‡æœ¬æ··åˆï¼‰ |
| è§†é¢‘ | âœ…ï¼ˆç‹¬ç«‹å‘é€ï¼Œä¸ä¸æ–‡æœ¬æ··åˆï¼‰ |
| æ–‡ä»¶ | âœ…ï¼ˆ`sendAttachment` actionï¼Œbase64 è·¨æœåŠ¡å™¨ä¼ è¾“ï¼‰ |
| å¼•ç”¨å›å¤ | âœ…ï¼ˆ`[[reply_to:xxx]]` æ ‡ç­¾ æˆ– `reply` actionï¼‰ |
| è¡¨æƒ…å›åº” | âœ…ï¼ˆ`react` actionï¼‰ |
| æ’¤å›æ¶ˆæ¯ | âœ…ï¼ˆ`unsend` / `delete` actionï¼‰ |

> **QQ åè®®é™åˆ¶**ï¼šè¯­éŸ³å’Œè§†é¢‘æ¶ˆæ¯æ®µå¿…é¡»ç‹¬ç«‹å‘é€ï¼Œä¸èƒ½å’Œæ–‡æœ¬æ··åœ¨åŒä¸€æ¡æ¶ˆæ¯ä¸­ã€‚æ’ä»¶è‡ªåŠ¨å¤„ç†ï¼šæœ‰æ–‡æœ¬+è¯­éŸ³æ—¶ï¼Œå…ˆå‘æ–‡æœ¬å†å‘è¯­éŸ³ã€‚

### è¯­éŸ³è½¬å†™é…ç½®

è¯­éŸ³è½¬å†™ç”± OpenClaw SDK å†…ç½®çš„ `transcribeFirstAudio` å¤„ç†ï¼Œéœ€è¦åœ¨ `openclaw.json` ä¸­é…ç½®éŸ³é¢‘è½¬å†™ providerï¼š

```jsonc
{
  "tools": {
    "media": {
      "audio": {
        "provider": "openai"  // æ”¯æŒ: openai / deepgram / google / groq / minimax ç­‰
      }
    }
  }
}
```

è½¬å†™æµç¨‹ï¼šQQ è¯­éŸ³ â†’ ä¸‹è½½åˆ°æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼ˆè‡ªåŠ¨æ£€æµ‹ `.silk` / `.amr` æ ¼å¼ï¼‰â†’ SDK è½¬å†™ â†’ æ–‡å­— â†’ è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶

å¦‚æœæœªé…ç½® `tools.media.audio` æˆ–è½¬å†™å¤±è´¥ï¼Œè¯­éŸ³æ¶ˆæ¯ä¿ç•™ä¸º `[è¯­éŸ³æ¶ˆæ¯]`ï¼Œä¸å½±å“å…¶ä»–åŠŸèƒ½ã€‚

## æ–œæ å‘½ä»¤

åœ¨ QQ å¯¹è¯ä¸­ç›´æ¥è¾“å…¥ï¼š

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/model <æ¨¡å‹å>` | åˆ‡æ¢å½“å‰ä¼šè¯æ¨¡å‹ |
| `/status` | æŸ¥çœ‹ä¼šè¯çŠ¶æ€ |
| `/reset` | é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡ |

å‘½ä»¤æƒé™åŸºäº `allowFrom` ç™½åå•ï¼Œæœªæˆæƒç”¨æˆ·çš„å‘½ä»¤ä¼šè¢«é™é»˜ä¸¢å¼ƒã€‚

## æ¶ˆæ¯ç›®æ ‡æ ¼å¼

é€šè¿‡ `message` å·¥å…·å‘ QQ å‘æ¶ˆæ¯æ—¶ï¼š

- **ç§èŠ**ï¼šç›´æ¥å¡« QQ å·ï¼Œå¦‚ `12345678`
- **ç¾¤èŠ**ï¼šåŠ  `g` å‰ç¼€ï¼Œå¦‚ `g87654321`
- **é»˜è®¤ç›®æ ‡**ï¼šé…ç½® `defaultTo` åå¯çœç•¥ `target` å‚æ•°

## ç½‘ç»œæ¶æ„

```
QQ ç”¨æˆ·
  â†• QQ åè®®
NapCatQQ (æœåŠ¡å™¨ A, ç«¯å£ 3001)
  â†• ws://127.0.0.1:3001
Nginx / å®å¡”åä»£ (æœåŠ¡å™¨ A)
  â†• wss://ä½ çš„åŸŸå
OpenClaw Gateway (æœåŠ¡å™¨ B, ä¸»åŠ¨è¿æ¥ â†’)
  â†• Agent å¤„ç†
QQ ç”¨æˆ·æ”¶åˆ°å›å¤
```

### åä»£é…ç½®

NapCat WebSocket æ˜¯**é•¿è¿æ¥**ï¼ŒNginx é»˜è®¤ 60 ç§’è¶…æ—¶ä¼šæ–­å¼€ï¼Œå¿…é¡»è°ƒå¤§ï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400s;   # 24 å°æ—¶
    proxy_send_timeout 86400s;
}
```

> æ’ä»¶å†…ç½®å¿ƒè·³æ£€æµ‹ï¼ˆé»˜è®¤ 60 ç§’è¶…æ—¶ï¼‰ï¼Œå³ä½¿ç½‘ç»œä¸­æ–­ä¹Ÿä¼šè‡ªåŠ¨é‡è¿ã€‚

## å¤šè´¦å·

æ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ª QQ å·ï¼š

```jsonc
{
  "channels": {
    "napcatqq": {
      "accounts": {
        "bot1": {
          "enabled": true,
          "wsUrl": "wss://bot1.example.com",
          "accessToken": "token1",
          "allowFrom": ["ç®¡ç†å‘˜QQå·"]
        },
        "bot2": {
          "enabled": true,
          "wsUrl": "wss://bot2.example.com",
          "accessToken": "token2",
          "allowFrom": ["ç®¡ç†å‘˜QQå·"]
        }
      }
    }
  }
}
```

## SDK é€‚é…å™¨æ¸…å•

æ’ä»¶å®ç°äº† OpenClaw ChannelPlugin å…¨éƒ¨ 14 ä¸ªé€‚é…å™¨ï¼š

| é€‚é…å™¨ | åŠŸèƒ½ |
|--------|------|
| `meta` | é€šé“æ ‡è¯†ã€æ ‡ç­¾ã€åˆ«å |
| `capabilities` | èƒ½åŠ›å£°æ˜ï¼ˆæ”¯æŒ/ä¸æ”¯æŒçš„ç‰¹æ€§ï¼‰ |
| `configSchema` | JSON Schema + UI Hintsï¼ˆæ§åˆ¶é¢æ¿ä¸­æ–‡è¡¨å•ï¼‰ |
| `config` | è´¦å·é…ç½®è¯»å†™ã€allowFrom è§£æã€defaultTo |
| `onboarding` | å‘å¯¼å¼é…ç½®ï¼ˆ`openclaw channels login`ï¼Œ10 æ­¥ï¼‰ |
| `setup` | å¿«æ·é…ç½®ï¼ˆ`openclaw channels add`ï¼‰ |
| `security` | DM ç­–ç•¥ã€å®‰å…¨è­¦å‘Šæ£€æµ‹ |
| `pairing` | é…å¯¹è®¤è¯ï¼ˆidLabelã€å®¡æ‰¹é€šçŸ¥ï¼‰ |
| `groups` | ç¾¤èŠ mention ç­–ç•¥ã€å·¥å…·æƒé™ |
| `directory` | è”ç³»äºº/ç¾¤åˆ—è¡¨ï¼ˆ`get_friend_list` / `get_group_list`ï¼‰ |
| `messaging` | ç›®æ ‡è§£æã€æ ¼å¼åŒ–æ˜¾ç¤º |
| `threading` | çº¿ç¨‹/å¼•ç”¨å›å¤æ¨¡å¼ |
| `outbound` | å‡ºç«™æ¶ˆæ¯å‘é€ï¼ˆæ–‡æœ¬/å›¾ç‰‡/è¯­éŸ³/è§†é¢‘/æ–‡ä»¶/chunkerï¼‰ |
| `status` | è¿æ¥çŠ¶æ€ã€bot ä¿¡æ¯ã€é—®é¢˜è¯Šæ–­ |
| `gateway` | WS é•¿è¿æ¥ç®¡ç†ï¼ˆstart/stop/logout/probeï¼‰ |

## æ–‡ä»¶ç»“æ„

```
openclaw-napcatqq/
â”œâ”€â”€ README.md
â”œâ”€â”€ ROADMAP.md                  # æœªå®ç°åŠŸèƒ½è·¯çº¿å›¾
â”œâ”€â”€ package.json                # npm åŒ…å®šä¹‰
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®ï¼ˆä»…ç±»å‹æ£€æŸ¥ï¼‰
â”œâ”€â”€ index.ts                    # å…¥å£ + PluginRuntime åˆå§‹åŒ–
â””â”€â”€ src/
    â”œâ”€â”€ types.ts                # OneBot v11 å…¨é‡ç±»å‹ï¼ˆ23 ç§æ¶ˆæ¯æ®µ + äº‹ä»¶ + APIï¼‰
    â”œâ”€â”€ runtime.ts              # PluginRuntime å…¨å±€å¼•ç”¨
    â”œâ”€â”€ client-store.ts         # WebSocket å®¢æˆ·ç«¯è¿æ¥æ± 
    â”œâ”€â”€ ws-client.ts            # WebSocket å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨é‡è¿ + å¿ƒè·³ + echo åŒ¹é… + é‡è¿æ¸…ç†ï¼‰
    â”œâ”€â”€ inbound.ts              # å…¥ç«™æ¶ˆæ¯è§£æï¼ˆArray + CQç åŒæ¨¡å¼ + QQè¡¨æƒ…æ˜ å°„ + è½¬å‘å±•å¼€ï¼‰
    â”œâ”€â”€ outbound.ts             # å‡ºç«™æ¶ˆæ¯å‘é€ + è¯­éŸ³/è§†é¢‘ç‹¬ç«‹å‘é€ + æ–‡ä»¶ä¸Šä¼  + API è°ƒç”¨
    â”œâ”€â”€ config.ts               # é…ç½®è¯»å–è¾…åŠ© + ChannelConfigAdapter
    â”œâ”€â”€ config-schema.ts        # JSON Schema + UI Hintsï¼ˆæ§åˆ¶é¢æ¿ä¸­æ–‡è¡¨å•ï¼‰
    â”œâ”€â”€ onboarding.ts           # å‘å¯¼å¼é…ç½® + Setup é€‚é…å™¨ï¼ˆ10 æ­¥ï¼‰
    â”œâ”€â”€ gateway.ts              # WS é•¿è¿æ¥ç®¡ç†ï¼ˆäº‹ä»¶è·¯ç”± / é€šçŸ¥å¤„ç† / è¯·æ±‚å¤„ç† / å†å²é¢„åŠ è½½ï¼‰
    â”œâ”€â”€ handler.ts              # å…¥ç«™æ¶ˆæ¯å¤„ç†ï¼ˆè®¿é—®æ§åˆ¶ / éŸ³é¢‘ä¸‹è½½ / ä¸Šä¸‹æ–‡æ„å»º / å›å¤åˆ†å‘ï¼‰
    â””â”€â”€ channel.ts              # é€šé“èƒ¶æ°´å±‚ï¼ˆmeta / capabilities / 10 actions / outbound / status + å¯¼å‡ºï¼‰
```

## åè®®

OneBot v11ï¼ˆNapCatQQ å®ç°ï¼‰

## License

MIT
